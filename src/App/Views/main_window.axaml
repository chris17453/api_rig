<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:App.ViewModels"
        xmlns:views="using:App.Views"
        xmlns:converters="using:App.Converters"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="App.Views.main_window"
        x:DataType="vm:main_view_model"
        Title="{Binding Title}"
        Width="1400" Height="900"
        WindowStartupLocation="CenterScreen"
        Icon="avares://App/Assets/logo.webp">

    <Window.Resources>
        <converters:theme_icon_converter x:Key="ThemeIconConverter"/>
    </Window.Resources>

    <Window.Styles>
        <!-- Modern Button Style -->
        <Style Selector="Button.modern">
            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ButtonTextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style Selector="Button.modern:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
        </Style>
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SuccessHoverBrush}"/>
        </Style>
        <Style Selector="Button.accent">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style Selector="Button.accent:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource AccentHoverBrush}"/>
        </Style>
    </Window.Styles>

    <!-- New Postman-like Layout -->
    <Grid RowDefinitions="Auto,*,Auto,Auto">
        <!-- Top Bar -->
        <views:top_bar_view Grid.Row="0"
                            DataContext="{Binding TopBar}"/>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto,*">
            <!-- Icon Bar (vertical nav) -->
            <views:icon_bar_view Grid.Column="0"
                                  DataContext="{Binding IconBar}"/>

            <!-- Side Panel (context-sensitive) -->
            <views:side_panel_view Grid.Column="1"
                                    DataContext="{Binding SidePanel}"
                                    IsVisible="{Binding $parent[Window].((vm:main_view_model)DataContext).IsSidebarVisible}"/>

            <!-- Content Area with Tabs -->
            <Border Grid.Column="2" Background="{DynamicResource AppBackgroundBrush}">
                <Grid RowDefinitions="Auto,*">
                    <!-- Tab Bar -->
                    <views:tab_bar_view Grid.Row="0"
                                        DataContext="{Binding Tabs}"/>

                    <!-- Tab Content Area - switches based on tab type -->
                    <Grid Grid.Row="1">
                        <!-- Request Tab Content -->
                        <Grid RowDefinitions="*,Auto,*"
                              IsVisible="{Binding Tabs.ActiveTab.ContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:TabContentType.Request}}">
                            <!-- Request Editor (top half) -->
                            <views:request_editor_view Grid.Row="0"
                                                       DataContext="{Binding RequestEditor}"
                                                       Margin="16,12,16,8"/>

                            <!-- Splitter -->
                            <GridSplitter Grid.Row="1"
                                          Height="6"
                                          HorizontalAlignment="Stretch"
                                          Background="{DynamicResource BorderBrush}"
                                          Cursor="SizeNorthSouth"/>

                            <!-- Response Viewer (bottom half) -->
                            <Border Grid.Row="2"
                                    Margin="16,8,16,8"
                                    Background="{DynamicResource CardBackgroundBrush}"
                                    CornerRadius="8"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1">
                                <views:response_viewer_view DataContext="{Binding ResponseViewer}"/>
                            </Border>
                        </Grid>

                        <!-- Environment Tab Content -->
                        <views:environment_editor_view
                              IsVisible="{Binding $parent[Window].((vm:main_view_model)DataContext).Tabs.ActiveTab.ContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:TabContentType.Environment}}"
                              DataContext="{Binding EnvironmentEditor}"
                              Margin="16,12,16,8"/>

                        <!-- Vault Secret Tab Content -->
                        <views:vault_editor_view
                              IsVisible="{Binding $parent[Window].((vm:main_view_model)DataContext).Tabs.ActiveTab.ContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:TabContentType.VaultSecret}}"
                              DataContext="{Binding VaultEditor}"
                              Margin="16,12,16,8"/>
                    </Grid>
                </Grid>
            </Border>
        </Grid>

        <!-- Console Panel (app-level bottom pane, collapsible) -->
        <views:console_panel_view Grid.Row="2"
                                  DataContext="{Binding ConsolePanel}"
                                  IsVisible="{Binding $parent[Window].((vm:main_view_model)DataContext).BottomBar.IsTerminalVisible}"
                                  Height="250"/>

        <!-- Bottom Bar -->
        <views:bottom_bar_view Grid.Row="3"
                               DataContext="{Binding BottomBar}"/>
    </Grid>
</Window>
