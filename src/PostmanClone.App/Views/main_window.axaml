<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:PostmanClone.App.ViewModels"
        xmlns:views="using:PostmanClone.App.Views"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="PostmanClone.App.Views.main_window"
        x:DataType="vm:main_view_model"
        Title="{Binding Title}"
        Width="1400" Height="900"
        WindowStartupLocation="CenterScreen"
        Background="#18181B"
        Icon="avares://PostmanClone.App/Assets/logo.webp">

    <!-- Keyboard Shortcuts -->
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+Return" Command="{Binding RequestEditor.SendRequestCommand}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveCurrentRequestCommand}"/>
        <KeyBinding Gesture="Ctrl+N" Command="{Binding NewRequestCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+N" Command="{Binding NewCollectionCommand}"/>
    </Window.KeyBindings>

    <Window.Styles>
        <!-- Header Button Style -->
        <Style Selector="Button.header-btn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#A1A1AA"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.header-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#27272A"/>
        </Style>
        
        <!-- Sidebar Button Style -->
        <Style Selector="Button.sidebar-btn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#A1A1AA"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.sidebar-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#27272A"/>
        </Style>
        
        <!-- Primary Button Style (Orange) -->
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#F97316"/>
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#EA580C"/>
        </Style>
        
        <!-- Ghost Button Style -->
        <Style Selector="Button.ghost">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#A1A1AA"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style Selector="Button.ghost:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#27272A"/>
            <Setter Property="BorderBrush" Value="#52525B"/>
        </Style>
        
        <!-- GridSplitter Style -->
        <Style Selector="GridSplitter">
            <Setter Property="Background" Value="#27272A"/>
        </Style>
        <Style Selector="GridSplitter:pointerover">
            <Setter Property="Background" Value="#F97316"/>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="48,*,Auto">
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- HEADER BAR - 48px -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="0" 
                Background="#09090B"
                BorderBrush="#27272A"
                BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Left Side: Toggle + Logo -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Sidebar Toggle -->
                    <Button Classes="header-btn"
                            Command="{Binding toggle_sidebarCommand}"
                            ToolTip.Tip="Toggle Sidebar"
                            Margin="8,0,0,0">
                        <TextBlock Text="â˜°" FontSize="16"/>
                    </Button>
                    
                    <!-- Logo -->
                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="12,0">
                        <Border CornerRadius="4" 
                                Background="#F97316"
                                Width="28" Height="28"
                                VerticalAlignment="Center">
                            <TextBlock Text="A" 
                                       FontSize="16" 
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="API Rig" 
                                   FontSize="14" 
                                   FontWeight="SemiBold"
                                   Foreground="#FAFAFA"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- Center: Empty -->
                <Border Grid.Column="1"/>
                
                <!-- Right Side: Action Buttons -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal" 
                            VerticalAlignment="Center"
                            Margin="0,0,12,0"
                            Spacing="4">
                    <!-- Runner -->
                    <Button Classes="header-btn"
                            Click="RunnerButton_Click"
                            ToolTip.Tip="Collection Runner">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBlock Text="â–¶" FontSize="11"/>
                            <TextBlock Text="Runner"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Code Generator -->
                    <Button Classes="header-btn"
                            Click="CodeButton_Click"
                            ToolTip.Tip="Generate Code (cURL, etc.)">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBlock Text="&lt;/&gt;" FontSize="11" FontFamily="Consolas"/>
                            <TextBlock Text="Code"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Keyboard Shortcuts -->
                    <Button Classes="header-btn"
                            Click="ShortcutsButton_Click"
                            ToolTip.Tip="Keyboard Shortcuts">
                        <TextBlock Text="âŒ¨" FontSize="14"/>
                    </Button>
                    
                    <!-- Theme Toggle -->
                    <Button Classes="header-btn"
                            x:Name="ThemeToggleButton"
                            Click="ThemeToggleButton_Click"
                            ToolTip.Tip="Toggle Theme">
                        <TextBlock x:Name="ThemeIcon" Text="â˜€" FontSize="14"/>
                    </Button>
                    
                    <!-- Settings -->
                    <Button Classes="header-btn"
                            Click="SettingsButton_Click"
                            ToolTip.Tip="Settings">
                        <TextBlock Text="âš™" FontSize="14"/>
                    </Button>
                    
                    <!-- About -->
                    <Button Classes="header-btn"
                            Click="AboutButton_Click"
                            ToolTip.Tip="About">
                        <TextBlock Text="â„¹" FontSize="14"/>
                    </Button>
                    
                    <!-- Separator -->
                    <Border Width="1" Height="24" Background="#3F3F46" Margin="8,0"/>
                    
                    <!-- Environment Selector -->
                    <views:environment_selector_view DataContext="{Binding EnvironmentSelector}"
                                                     VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- MAIN CONTENT AREA -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
            <!-- SIDEBAR -->
            <Border Grid.Column="0" 
                    IsVisible="{Binding IsSidebarVisible}"
                    Background="#09090B"
                    BorderBrush="#27272A"
                    BorderThickness="0,0,1,0"
                    Width="288"
                    MinWidth="200"
                    MaxWidth="400">
                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Sidebar Header: Search + New Button -->
                    <Border Grid.Row="0" Padding="12,12,12,8">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0"
                                     Text="{Binding Sidebar.HistorySearchText, Mode=TwoWay}"
                                     Watermark="ðŸ” Search..."
                                     Background="#18181B"
                                     BorderBrush="#3F3F46"
                                     Foreground="#FAFAFA"
                                     FontSize="12"
                                     Padding="8,6"
                                     CornerRadius="4"/>
                            <Button Grid.Column="1"
                                    Classes="sidebar-btn"
                                    Command="{Binding Sidebar.CreateCollectionCommand}"
                                    ToolTip.Tip="New Collection"
                                    Margin="8,0,0,0">
                                <TextBlock Text="+" FontSize="16" FontWeight="Bold"/>
                            </Button>
                        </Grid>
                    </Border>
                    
                    <!-- Collections/History Content -->
                    <views:sidebar_view Grid.Row="1" 
                                        DataContext="{Binding Sidebar}"/>
                    
                    <!-- Sidebar Footer: Import/Export -->
                    <Border Grid.Row="2" 
                            Background="#09090B"
                            BorderBrush="#27272A"
                            BorderThickness="0,1,0,0"
                            Padding="12,8">
                        <Grid ColumnDefinitions="*,*">
                            <Button Grid.Column="0"
                                    Classes="ghost"
                                    Click="ImportButton_Click"
                                    HorizontalAlignment="Stretch"
                                    Margin="0,0,4,0">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="â†“" FontSize="12"/>
                                    <TextBlock Text="Import"/>
                                </StackPanel>
                            </Button>
                            <Button Grid.Column="1"
                                    Classes="ghost"
                                    Click="ExportButton_Click"
                                    HorizontalAlignment="Stretch"
                                    Margin="4,0,0,0">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="â†‘" FontSize="12"/>
                                    <TextBlock Text="Export"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Left Splitter -->
            <GridSplitter Grid.Column="1" 
                          Width="4"
                          IsVisible="{Binding IsSidebarVisible}"
                          ResizeDirection="Columns"
                          ResizeBehavior="PreviousAndNext"/>
            
            <!-- MAIN CONTENT -->
            <Border Grid.Column="2" Background="#18181B">
                <Grid RowDefinitions="Auto,*">
                    <!-- Tab Bar -->
                    <views:tab_bar_view Grid.Row="0" 
                                        DataContext="{Binding Tabs}"/>
                    
                    <!-- Request/Response Split -->
                    <Grid Grid.Row="1" RowDefinitions="*,Auto,*">
                        <!-- Request Panel -->
                        <Border Grid.Row="0" Margin="16,12,16,0">
                            <Grid RowDefinitions="Auto,*">
                                <!-- URL Bar + Request Editor -->
                                <views:request_editor_view Grid.Row="0" 
                                                           DataContext="{Binding RequestEditor}"/>
                                
                                <!-- Script Editor -->
                                <Border Grid.Row="1" 
                                        Margin="0,12,0,0"
                                        Background="#09090B"
                                        CornerRadius="8"
                                        BorderBrush="#27272A"
                                        BorderThickness="1"
                                        MinHeight="150">
                                    <views:script_editor_view DataContext="{Binding ScriptEditor}"/>
                                </Border>
                            </Grid>
                        </Border>
                        
                        <!-- Horizontal Splitter -->
                        <GridSplitter Grid.Row="1" 
                                      Height="4"
                                      HorizontalAlignment="Stretch"
                                      ResizeDirection="Rows"
                                      ResizeBehavior="PreviousAndNext"
                                      Margin="16,8"/>
                        
                        <!-- Response Panel -->
                        <Border Grid.Row="2" 
                                Margin="16,0,16,12"
                                Background="#09090B"
                                CornerRadius="8"
                                BorderBrush="#27272A"
                                BorderThickness="1">
                            <views:response_viewer_view DataContext="{Binding ResponseViewer}"/>
                        </Border>
                    </Grid>
                </Grid>
            </Border>
            
            <!-- Right Splitter -->
            <GridSplitter Grid.Column="3" 
                          Width="4"
                          ResizeDirection="Columns"
                          ResizeBehavior="PreviousAndNext"/>
            
            <!-- RIGHT PANEL - Test Results -->
            <Border Grid.Column="4" 
                    Background="#09090B"
                    BorderBrush="#27272A"
                    BorderThickness="1,0,0,0"
                    Width="280"
                    MinWidth="200"
                    MaxWidth="400">
                <views:test_results_view DataContext="{Binding TestResults}"/>
            </Border>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- CONSOLE (Bottom Panel - Collapsible) -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="2" 
                Background="#09090B"
                BorderBrush="#27272A"
                BorderThickness="0,1,0,0"
                IsVisible="{Binding IsConsoleVisible}"
                Height="180">
            <Grid RowDefinitions="Auto,*">
                <!-- Console Header -->
                <Border Grid.Row="0" 
                        Background="#09090B"
                        Padding="12,8">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="â–¸" FontSize="12" Foreground="#A1A1AA"/>
                            <TextBlock Text="Console" 
                                       FontSize="12" 
                                       FontWeight="SemiBold"
                                       Foreground="#FAFAFA"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                            <Button Classes="sidebar-btn"
                                    Command="{Binding ScriptEditor.ClearConsoleCommand}"
                                    ToolTip.Tip="Clear Console">
                                <TextBlock Text="ðŸ—‘" FontSize="12"/>
                            </Button>
                            <Button Classes="sidebar-btn"
                                    Command="{Binding ToggleConsoleCommand}"
                                    ToolTip.Tip="Close Console">
                                <TextBlock Text="â–¼" FontSize="10"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Console Output -->
                <ScrollViewer Grid.Row="1" 
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              Padding="12,0">
                    <TextBlock Text="{Binding ScriptEditor.ConsoleOutput}"
                               FontFamily="Consolas, Courier New, monospace"
                               FontSize="11"
                               Foreground="#A1A1AA"
                               TextWrapping="Wrap"/>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>
